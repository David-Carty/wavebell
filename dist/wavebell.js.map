{"version":3,"file":"wavebell.js","sources":["../lib/util/emitter.js","../lib/util/assert.js","../lib/media/audio_filter.js","../lib/media/volume_meter.js","../lib/util/props.js","../lib/media/user_media.js","../lib/media/recorder.js","../lib/wavebell.js"],"sourcesContent":["/*\n * Copyright (C) 2017, Skyler.\n * Use of this source code is governed by the MIT license that can be\n * found in the LICENSE file.\n */\n\nfunction slice (args, from) {\n  return Array.prototype.slice.call(args, from)\n}\n\nclass Emitter {\n  constructor () {\n    this.handlerMap = {}\n  }\n\n  on (event, handler) {\n    if (typeof event !== 'string') {\n      throw new TypeError(event + ' is not a string')\n    }\n    if (typeof handler !== 'function') {\n      throw new TypeError(handler + ' is not a function')\n    }\n    let map = this.handlerMap\n    let handlers = map[event] = map[event] || []\n    let i = handlers.indexOf(handler)\n    if (i === -1) {\n      handlers.push(handler)\n    }\n    return this\n  }\n\n  off (event, handler) {\n    if (handler === undefined) {\n      // remove all handlers\n      delete this.handlerMap[event]\n      return this\n    }\n    // remove registered handler\n    let handlers = this.handlerMap[event]\n    if (handlers) {\n      let i = handlers.indexOf(handler)\n      if (i >= 0) {\n        handlers.splice(i, 1)\n      }\n      // cleanup empty handlers\n      if (handlers.length === 0) {\n        this.off(event)\n      }\n    }\n    return this\n  }\n\n  emit (event) {\n    let args = slice(arguments, 1)\n    let handlers = this.handlerMap[event]\n    if (handlers) {\n      for (let i = 0, len = handlers.length; i < len; i++) {\n        handlers[i].apply(undefined, args)\n      }\n    }\n    return this\n  }\n}\n\nexport default Emitter\n","/*\n * Copyright (C) 2017, Skyler.\n * Use of this source code is governed by the MIT license that can be\n * found in the LICENSE file.\n */\n\nclass Assertion {\n  constructor (value) {\n    this.value = value\n    this._negative = false\n    this._error = new Error('Assertion failed')\n  }\n\n  get to () {\n    return this\n  }\n\n  get not () {\n    this._negative = !this._negative\n    return this\n  }\n\n  that (error) {\n    this._error = error\n    return this\n  }\n\n  equal (value) {\n    if ((value === this.value) === this._negative) {\n      throw this._error\n    }\n  }\n}\n\nfunction assert (value) {\n  return new Assertion(value)\n}\n\nexport default assert\n","/*\n * Copyright (C) 2017, Skyler.\n * Use of this source code is governed by the MIT license that can be\n * found in the LICENSE file.\n */\n\nconst AudioContext = window.AudioContext || window.webkitAudioContext\n\n// AudioContext singleton shared by filters\nlet audioContext = null\n\nclass AudioFilter {\n  /**\n   * Get AudioContext instance\n   * @returns {AudioContext} - Shared instance\n   */\n  get context () {\n    if (!audioContext) {\n      audioContext = new AudioContext()\n    }\n    return audioContext\n  }\n}\n\nexport default AudioFilter\n","/*\n * Copyright (C) 2017, Skyler.\n * Use of this source code is governed by the MIT license that can be\n * found in the LICENSE file.\n */\n\nimport AudioFilter from './audio_filter'\n\nclass VolumeMeter extends AudioFilter {\n  constructor (mainbus, options) {\n    super()\n    this.mainbus = mainbus\n    this.options = Object.assign({\n      minLimit: 0,\n      maxLimit: 128,\n      fftSize: 1024,\n      smoothing: 0.3\n    }, options)\n    this._checkOptions(this.options)\n    this.source = null\n    this.analyser = this.init(this.options)\n  }\n\n  _checkOptions (options) {\n    if (options.maxLimit <= options.minLimit) {\n      throw new RangeError('Wrong limit range for volume')\n    }\n  }\n\n  init (options) {\n    // init analyser from options\n    /// ref: https://developer.mozilla.org/en-US/docs/Web/API/AnalyserNode\n    let analyser = this.context.createAnalyser()\n    analyser.fftSize = options.fftSize\n    analyser.smoothingTimeConstant = options.smoothing\n\n    // use auto buffer size and only 1 I/O channel\n    /// ref: https://developer.mozilla.org/en-US/docs/Web/API/BaseAudioContext/createScriptProcessor\n    let processor = this.context.createScriptProcessor(0, 1, 1)\n    processor.onaudioprocess = e => {\n      if (this.mainbus.state === 'recording') {\n        this._processData(e)\n      }\n    }\n\n    // connect processing pipeline\n    /// ref: https://developer.mozilla.org/en-US/docs/Web/API/AudioContext/createMediaStreamSource\n    analyser.connect(processor)\n    processor.connect(this.context.destination)\n\n    return analyser\n  }\n\n  pipe (stream) {\n    // connect source stream\n    this.source = this.context.createMediaStreamSource(stream)\n    this.source.connect(this.analyser)\n  }\n\n  cutoff () {\n    this.source.disconnect(this.analyser)\n    this.source = null\n  }\n\n  _processData (e) {\n    // half of the fftSize\n    let data = new Uint8Array(this.analyser.frequencyBinCount)\n    this.analyser.getByteFrequencyData(data)\n    let volume = this._calcAvgVolume(data)\n    this.mainbus.emit('wave', {\n      value: this._alignVolume(volume)\n    })\n  }\n\n  _alignVolume (volume) {\n    let opts = this.options\n    if (volume < opts.minLimit) {\n      volume = opts.minLimit\n    }\n    if (volume > opts.maxLimit) {\n      volume = opts.maxLimit\n    }\n    return (volume - opts.minLimit) / (opts.maxLimit - opts.minLimit)\n  }\n\n  _calcAvgVolume (data) {\n    let sum = 0\n    let len = data.length\n    for (let i = 0; i < len; i++) {\n      sum += data[i]\n    }\n    return sum / len\n  }\n}\n\nexport default VolumeMeter\n","/*\n * Copyright (C) 2017, Skyler.\n * Use of this source code is governed by the MIT license that can be\n * found in the LICENSE file.\n */\n\nconst hasOwn = Object.prototype.hasOwnProperty\n\nclass PropPath {\n  constructor (path) {\n    this.steps = path.split('.')\n    this.fallback = undefined\n  }\n\n  travel (target, fn) {\n    if (typeof fn !== 'function') {\n      throw new TypeError(fn + ' is not a function')\n    }\n    let len = this.steps.length\n    let i = 0\n    let step = this.steps[i]\n    while (fn(target, step) && i < len) {\n      target = target[step]\n      step = this.steps[++i]\n    }\n    return {\n      step: i,\n      value: target\n    }\n  }\n\n  or (defaultValue) {\n    this.fallback = defaultValue\n    return this\n  }\n\n  from (obj) {\n    let ret = this.travel(obj, (target, step) => {\n      return target != null && step in Object(target)\n    })\n    if (ret.step === this.steps.length) {\n      return ret.value\n    } else {\n      return this.fallback\n    }\n  }\n\n  hadBy (obj) {\n    let ret = this.travel(obj, (target, step) => {\n      return target != null && step in Object(target)\n    })\n    return ret.step === this.steps.length\n  }\n\n  ownedBy (obj) {\n    let ret = this.travel(obj, (target, step) => {\n      return target != null && hasOwn.call(target, step)\n    })\n    return ret.step === this.steps.length\n  }\n}\n\nfunction props (path) {\n  if (typeof path !== 'string') {\n    throw new TypeError(path + ' is not a string')\n  }\n  return new PropPath(path)\n}\n\nexport default props\n","/*\n * Copyright (C) 2017, Skyler.\n * Use of this source code is governed by the MIT license that can be\n * found in the LICENSE file.\n */\n\nimport props from '@/util/props'\n\n/**\n * Shim for MediaDevices#getUserMedia method\n * @param {object} constraints - The user media constraints\n */\nfunction getUserMedia (constraints) {\n  if (props('navigator.mediaDevices.getUserMedia').hadBy(window)) {\n    let medias = props('navigator.mediaDevices').from(window)\n    return medias.getUserMedia(constraints)\n  }\n  let userMediaGetter = navigator.getUserMedia ||\n                        navigator.webkitGetUserMedia ||\n                        navigator.mozGetUserMedia ||\n                        navigator.msGetUserMedia\n  if (!userMediaGetter) {\n    throw new Error('getUserMedia is not supported by this browser')\n  }\n  return new Promise((resolve, reject) => {\n    userMediaGetter(constraints, resolve, reject)\n  })\n}\n\n/**\n * Access audio input from microphone device\n */\nfunction getUserMicrophone () {\n  return getUserMedia({ audio: true, video: false })\n}\n\nexport {\n  getUserMedia,\n  getUserMicrophone\n}\n","/*\n * Copyright (C) 2017, Skyler.\n * Use of this source code is governed by the MIT license that can be\n * found in the LICENSE file.\n */\n\nimport Emitter from '@/util/emitter'\nimport assert from '@/util/assert'\nimport VolumeMeter from './volume_meter'\nimport { getUserMicrophone } from './user_media'\n\nfunction buildError (self, callee) {\n  return new Error(`Failed to execute '${callee}' on 'Recorder':\\n` +\n    `The Recorder's state is '${self.state}'.`)\n}\n\nclass Recorder extends Emitter {\n  constructor (options) {\n    super()\n    this.options = Object.assign({\n      mimeType: 'audio/webm',\n      audioBitsPerSecond: 96000\n    }, options)\n    this._intern = null\n    this._result = null\n    this._filter = new VolumeMeter(this, this.options.meter)\n  }\n\n  get state () {\n    if (this._intern === null) {\n      return 'inactive'\n    } else {\n      return this._intern.state\n    }\n  }\n\n  get ready () {\n    return this._intern !== null\n  }\n\n  get result () {\n    return new Blob(this._result, {\n      type: this._intern.mimeType\n    })\n  }\n\n  open () {\n    return getUserMicrophone().then(stream => {\n      // create internal recorder\n      this._intern = new MediaRecorder(stream, this.options)\n      // register event listeners\n      let eventTypes = ['error', 'pause', 'resume', 'start', 'stop']\n      eventTypes.map(type => {\n        this._intern.addEventListener(type, e => this.emit(type, e))\n      })\n      this._intern.addEventListener('dataavailable', e => {\n        this._result.push(e.data)\n      })\n      // pipe stream to filter\n      this._filter.pipe(stream)\n    })\n  }\n\n  close () {\n    this._filter.cutoff()\n    this._intern = null\n    this._result = null\n  }\n\n  start (timeslice) {\n    assert(this.state).that(buildError(this, 'start')).to.equal('inactive')\n    // init result data on every start\n    this._result = []\n    // use lazy open policy\n    if (!this.ready) {\n      this.open().then(() => {\n        this._intern.start(timeslice)\n      })\n    } else {\n      this._intern.start(timeslice)\n    }\n  }\n\n  stop () {\n    assert(this.state).that(buildError(this, 'stop')).to.not.equal('inactive')\n    this._intern.stop()\n  }\n\n  pause () {\n    assert(this.state).that(buildError(this, 'pause')).to.equal('recording')\n    this._intern.pause()\n  }\n\n  resume () {\n    assert(this.state).that(buildError(this, 'resume')).to.equal('paused')\n    this._intern.resume()\n  }\n}\n\nexport default Recorder\n","/*\n * Copyright (C) 2017, Skyler.\n * Use of this source code is governed by the MIT license that can be\n * found in the LICENSE file.\n */\n\nimport Recorder from '@/media/recorder'\n\nclass WaveBell extends Recorder {}\n\nexport default WaveBell\n"],"names":["slice","args","from","Array","prototype","call","Emitter","handlerMap","event","handler","TypeError","map","handlers","i","indexOf","push","undefined","splice","length","off","arguments","len","apply","Assertion","value","_negative","_error","Error","error","assert","AudioContext","window","webkitAudioContext","audioContext","AudioFilter","VolumeMeter","mainbus","options","Object","assign","_checkOptions","source","analyser","init","maxLimit","minLimit","RangeError","context","createAnalyser","fftSize","smoothingTimeConstant","smoothing","processor","createScriptProcessor","onaudioprocess","state","_processData","e","connect","destination","stream","createMediaStreamSource","disconnect","data","Uint8Array","frequencyBinCount","getByteFrequencyData","volume","_calcAvgVolume","emit","_alignVolume","opts","sum","hasOwn","hasOwnProperty","PropPath","path","steps","split","fallback","target","fn","step","defaultValue","obj","ret","travel","props","getUserMedia","constraints","hadBy","medias","userMediaGetter","navigator","webkitGetUserMedia","mozGetUserMedia","msGetUserMedia","Promise","resolve","reject","getUserMicrophone","audio","video","buildError","self","callee","Recorder","_intern","_result","_filter","meter","then","MediaRecorder","eventTypes","addEventListener","type","pipe","cutoff","timeslice","that","to","equal","ready","open","start","not","stop","pause","resume","Blob","mimeType","WaveBell"],"mappings":"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"}